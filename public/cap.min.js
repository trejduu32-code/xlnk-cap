(() => {
    const t = "0.0.6",
        e = (...t) => window?.CAP_CUSTOM_FETCH ? window.CAP_CUSTOM_FETCH(...t) : fetch(...t);

    function a(t, e) {
        let a = function(t) {
            let e = 2166136261;
            for (let a = 0; a < t.length; a++)
                e ^= t.charCodeAt(a),
                e += (e << 1) + (e << 4) + (e << 7) + (e << 8) + (e << 24);
            return e >>> 0
        }(t), n = "";

        function r() {
            return a ^= a << 13,
                a ^= a >>> 17,
                a ^= a << 5,
                a >>> 0
        }
        for (; n.length < e;) n += r().toString(16).padStart(8, "0");
        return n.substring(0, e)
    }

    window.CAP_CUSTOM_WASM_URL || [
        `https://cdn.jsdelivr.net/npm/@cap.js/wasm@${t}/browser/cap_wasm.min.js`,
        `https://cdn.jsdelivr.net/npm/@cap.js/wasm@${t}/browser/cap_wasm_bg.wasm`
    ].forEach(t => {
        const e = document.createElement("link");
        e.rel = "prefetch",
            e.href = t,
            e.as = t.endsWith(".wasm") ? "fetch" : "script",
            document.head.appendChild(e)
    });

    class n extends HTMLElement {
        #t = "";
        #e = null;
        #a = navigator.hardwareConcurrency || 8;
        token = null;
        #n;
        #r;
        #o;
        #i = !1;
        #s;

        getI18nText(t, e) {
            return this.getAttribute(`data-cap-i18n-${t}`) || e
        }

        static get observedAttributes() {
            return ["onsolve", "onprogress", "onreset", "onerror", "data-cap-worker-count", "data-cap-i18n-initial-state", "[cap]"]
        }

        constructor() {
            super(),
            this.#s && this.#s.forEach((t, e) => {
                this.removeEventListener(e.slice(2), t)
            }),
            this.#s = new Map,
            this.boundHandleProgress = this.handleProgress?.bind(this),
            this.boundHandleSolve = this.handleSolve?.bind(this),
            this.boundHandleError = this.handleError?.bind(this),
            this.boundHandleReset = this.handleReset?.bind(this)
        }

        initialize() {
            this.#t = URL.createObjectURL(new Blob([`(()=>{if("object"!=typeof WebAssembly||"function"!=typeof WebAssembly?.instantiate)return self.onmessage=async({data:{salt:e,target:r}})=>{let o=0;const t=new TextEncoder,s=new Uint8Array(r.length/2);for(let e=0;e<s.length;e++)s[e]=parseInt(r.substring(2*e,2*e+2),16);const n=s.length;for(;;)try{for(let r=0;r<5e4;r++){const r=e+o,a=t.encode(r),l=await crypto.subtle.digest("SHA-256",a),c=new Uint8Array(l,0,n);let f=!0;for(let e=0;e<n;e++)if(c[e]!==s[e]){f=!1;break}if(f)return void self.postMessage({nonce:o,found:!0});o++}}catch(e){return console.error("[xlnk worker]",e),void self.postMessage({found:!1,error:e.message})}},console.warn("[xlnk worker] wasm not supported, falling back to alternative solver. this will be significantly slower.");let e,r;self.onmessage=async({data:{salt:o,target:t,wasmUrl:s}})=>{e!==s&&(e=s,await import(s).then(e=>e.default().then(o=>{r=(o?.exports?o.exports:e).solve_pow})).catch(e=>{console.error("[xlnk worker] using fallback solver due to error:",e)}));try{const e=performance.now(),s=r(o,t),n=performance.now();self.postMessage({nonce:Number(s),found:!0,durationMs:(n-e).toFixed(2})}catch(e){console.error("[xlnk worker]",e),self.postMessage({found:!1,error:e.message||String(e)})}},self.onerror=e=>{self.postMessage({found:!1,error:e})}})();`], { type: "application/javascript" }))
        }

        attributeChangedCallback(t, e, a) {
            if (t.startsWith("on")) {
                const e = t.slice(2),
                    n = this.#s.get(t);
                n && this.removeEventListener(e, n),
                a && (this.#s.set(t, e => {
                    const a = this.getAttribute(t);
                    "function" == typeof window[a] && window[a].call(this, e)
                }), this.addEventListener(e, this.#s.get(t)))
            }
        }

        async connectedCallback() {
            this.#o = this,
            this.#n = this.attachShadow({ mode: "open" }),
            this.#r = document.createElement("div"),
            this.createUI(),
            this.initialize();
        }

        createUI() {
            this.#r.classList.add("captcha"),
            this.#r.setAttribute("part", "container"),
            this.#r.innerHTML = `
            <style>
                .captcha { display:inline-flex; flex-direction:row; align-items:center; cursor:pointer; background:#f5f5f5; border:2px solid #ddd; border-radius:6px; padding:10px 15px; user-select:none; }
                .captcha:hover { border-color:#888; }
                .captcha p { margin:0 10px; font-family:sans-serif; font-size:14px; color:#333; }
                .checkbox { width:20px; height:20px; border:2px solid #999; border-radius:4px; display:flex; align-items:center; justify-content:center; margin-right:10px; }
                .icon { width:16px; height:16px; display:none; }
                .icon-check { stroke:green; }
                .icon-error { fill:red; }
                .credits { font-size:12px; color:#666; text-decoration:none; margin-left:10px; }
                .credits:hover { text-decoration:underline; }
            </style>
            <div class="checkbox">
                <svg class="icon icon-check" viewBox="0 0 24 24"><path d="M5 12 10 17 20 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <svg class="icon icon-error" viewBox="0 0 24 24"><path fill="currentColor" d="M11 15h2v2h-2zm0-8h2v6h-2zm1-5C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 18a8 8 0 0 1-8-8a8 8 0 0 1 8-8a8 8 0 0 1 8 8a8 8 0 0 1-8 8" /></svg>
            </div>
            <p>Verify to continue</p>
            <a href="https://xlnk-cap.11by.workers.dev" class="credits" target="_blank" rel="noopener">Xlnk</a>
            `;
            this.#n.appendChild(this.#r);

            this.#r.addEventListener("click", () => {
                window.open("https://xlnk-cap.11by.workers.dev", "_blank");
            });
        }
    }

    customElements.define("xlnk-widget", n);
})();
